/**
 * 5.1å¥—åˆ©ç³»ç»Ÿ - ç»Ÿä¸€APIæœåŠ¡å±‚
 * 
 * æä¾›ä¸ŽåŽç«¯æœåŠ¡çš„ç»Ÿä¸€æŽ¥å£ï¼ŒåŒ…æ‹¬ï¼š
 * - ç³»ç»ŸæŽ§åˆ¶API
 * - æ¸…æ´—æ¨¡å—API  
 * - ç­–ç•¥æ¨¡å—API
 * - é£Žé™©ç®¡ç†API
 * - æž¶æž„ç›‘æŽ§API
 * - å¯è§‚æµ‹æ€§API
 */

import axios from 'axios';

// APIåŸºç¡€é…ç½®
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://57.183.21.242:8080';

// åˆ›å»ºaxioså®žä¾‹
const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
});

// è¯·æ±‚æ‹¦æˆªå™¨
apiClient.interceptors.request.use(
  (config) => {
    console.log(`ðŸš€ APIè¯·æ±‚: ${config.method?.toUpperCase()} ${config.url}`);
    return config;
  },
  (error) => {
    console.error('âŒ APIè¯·æ±‚é”™è¯¯:', error);
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
apiClient.interceptors.response.use(
  (response) => {
    console.log(`âœ… APIå“åº”: ${response.status} ${response.config.url}`);
    return response;
  },
  (error) => {
    console.error('âŒ APIå“åº”é”™è¯¯:', error.response?.status, error.response?.data || error.message);
    
    // ç»Ÿä¸€é”™è¯¯å¤„ç†
    if (error.response) {
      // æœåŠ¡å™¨è¿”å›žé”™è¯¯çŠ¶æ€ç 
      const errorMessage = error.response.data?.message || `è¯·æ±‚å¤±è´¥ (${error.response.status})`;
      return Promise.reject(new Error(errorMessage));
    } else if (error.request) {
      // ç½‘ç»œé”™è¯¯
      return Promise.reject(new Error('ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åŽç«¯æœåŠ¡çŠ¶æ€'));
    } else {
      // å…¶ä»–é”™è¯¯
      return Promise.reject(new Error(error.message));
    }
  }
);

// ç»Ÿä¸€APIæœåŠ¡å¯¹è±¡
export const apiService = {
  
  // ===== ç³»ç»ŸæŽ§åˆ¶æ¨¡å— API =====
  system: {
    // èŽ·å–ç³»ç»ŸçŠ¶æ€
    getStatus: () => apiClient.get('/api/system/status'),
    
    // å¯åŠ¨ç³»ç»Ÿ
    start: () => apiClient.post('/api/system/start'),
    
    // åœæ­¢ç³»ç»Ÿ
    stop: () => apiClient.post('/api/system/stop'),
    
    // èŽ·å–ç³»ç»Ÿæ—¥å¿—
    getLogs: (lines = 50) => apiClient.get(`/api/system/logs?lines=${lines}`),
    
    // å¥åº·æ£€æŸ¥
    health: () => apiClient.get('/api/health'),
  },

  // ===== æ¸…æ´—æ¨¡å— API =====
  qingxi: {
    // èŽ·å–æ•°æ®æ”¶é›†å™¨åˆ—è¡¨ (çœŸå®žAPI)
    getCollectors: () => apiClient.get('/api/qingxi/collectors/list'),
    
    // å¯åŠ¨æ•°æ®æ”¶é›†å™¨ (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    startCollector: (collectorId) => {
      console.warn(`âš ï¸  å¯åŠ¨æ”¶é›†å™¨ ${collectorId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { success: true, message: `æ”¶é›†å™¨ ${collectorId} å¯åŠ¨æˆåŠŸ` }
      });
    },
    
    // åœæ­¢æ•°æ®æ”¶é›†å™¨ (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    stopCollector: (collectorId) => {
      console.warn(`âš ï¸  åœæ­¢æ”¶é›†å™¨ ${collectorId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { success: true, message: `æ”¶é›†å™¨ ${collectorId} å·²åœæ­¢` }
      });
    },
    
    // èŽ·å–æ•°æ®æ”¶é›†å™¨çŠ¶æ€ (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    getCollectorStatus: (collectorId) => {
      console.warn(`âš ï¸  èŽ·å–æ”¶é›†å™¨çŠ¶æ€ ${collectorId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { status: 'running', lastUpdate: new Date().toISOString() }
      });
    },
    
    // èŽ·å–æ•°æ®è´¨é‡ç»Ÿè®¡ (çœŸå®žAPI)
    getDataQuality: () => apiClient.get('/api/qingxi/data/quality'),
    
    // èŽ·å–æ•°æ®æµé‡ç»Ÿè®¡ (çœŸå®žAPI)
    getDataFlow: () => apiClient.get('/api/qingxi/data/flow'),
  },

  // ===== ç­–ç•¥æ¨¡å— API =====
  celue: {
    // èŽ·å–ç­–ç•¥åˆ—è¡¨ (çœŸå®žAPI)
    getStrategies: () => apiClient.get('/api/celue/strategies'),
    
    // èŽ·å–ç­–ç•¥è¯¦æƒ… (æ¨¡æ‹Ÿå®žçŽ°)
    getStrategy: (strategyId) => {
      console.warn(`âš ï¸  èŽ·å–ç­–ç•¥è¯¦æƒ… ${strategyId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { id: strategyId, name: `ç­–ç•¥ ${strategyId}`, status: 'running' }
      });
    },
    
    // å¯åŠ¨ç­–ç•¥ (æ¨¡æ‹Ÿå®žçŽ°)
    startStrategy: (strategyId) => {
      console.warn(`âš ï¸  å¯åŠ¨ç­–ç•¥ ${strategyId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { success: true, message: `ç­–ç•¥ ${strategyId} å¯åŠ¨æˆåŠŸ` }
      });
    },
    
    // åœæ­¢ç­–ç•¥ (æ¨¡æ‹Ÿå®žçŽ°)
    stopStrategy: (strategyId) => {
      console.warn(`âš ï¸  åœæ­¢ç­–ç•¥ ${strategyId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { success: true, message: `ç­–ç•¥ ${strategyId} å·²åœæ­¢` }
      });
    },
    
    // èŽ·å–ç­–ç•¥æ€§èƒ½æ•°æ® (çœŸå®žAPI)
    getPerformance: () => apiClient.get('/api/celue/performance'),
    
    // èŽ·å–äº¤æ˜“æ‰€ä»·å·®å¯¹æ¯” (çœŸå®žAPI)
    getExchangeComparison: () => apiClient.get('/api/celue/exchange-comparison'),
    
    // èŽ·å–ç­–ç•¥æ‰§è¡Œç»“æžœ (æ¨¡æ‹Ÿå®žçŽ°)
    getStrategyResults: (strategyId) => {
      console.warn(`âš ï¸  èŽ·å–ç­–ç•¥ç»“æžœ ${strategyId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { strategyId, results: [] }
      });
    },
    
    // æ›´æ–°ç­–ç•¥é…ç½® (æ¨¡æ‹Ÿå®žçŽ°)
    updateStrategy: (strategyId, config) => {
      console.warn(`âš ï¸  æ›´æ–°ç­–ç•¥é…ç½® ${strategyId} - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”`);
      return Promise.resolve({
        data: { success: true, message: 'é…ç½®æ›´æ–°æˆåŠŸ' }
      });
    },
  },

  // ===== é£Žé™©ç®¡ç†æ¨¡å— API =====
  risk: {
    // èŽ·å–é£Žé™©çŠ¶æ€ (çœŸå®žAPI)
    getStatus: () => apiClient.get('/api/risk/status'),
    
    // èŽ·å–é£Žé™©æŒ‡æ ‡ (çœŸå®žAPI)
    getMetrics: () => apiClient.get('/api/risk/metrics'),
    
    // èŽ·å–é£Žé™©é¢„è­¦ (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    getAlerts: () => {
      console.warn('âš ï¸  èŽ·å–é£Žé™©é¢„è­¦ - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”');
      const alertTypes = [
        { title: 'æœ€å¤§å›žæ’¤è¶…é™', metric: 'maxDrawdown', severity: 'high' },
        { title: 'èµ„é‡‘ä½¿ç”¨çŽ‡è¿‡é«˜', metric: 'capitalUtilization', severity: 'medium' },
        { title: 'å¸‚åœºæ³¢åŠ¨åŠ å‰§', metric: 'volatility', severity: 'medium' },
        { title: 'æµåŠ¨æ€§ä¸è¶³', metric: 'liquidity', severity: 'high' },
        { title: 'äº¤æ˜“æ‰€è¿žæŽ¥å¼‚å¸¸', metric: 'connectivity', severity: 'low' }
      ];
      
      const activeAlerts = alertTypes
        .slice(0, Math.floor(Math.random() * 4))
        .map((alert, i) => ({
          id: `alert_${i + 1}`,
          title: alert.title,
          message: `${alert.title}ï¼Œå½“å‰æŒ‡æ ‡å·²è§¦å‘é¢„è­¦é˜ˆå€¼ï¼Œè¯·åŠæ—¶å…³æ³¨`,
          severity: alert.severity,
          metric: alert.metric,
          currentValue: `${(Math.random() * 100).toFixed(2)}%`,
          timestamp: new Date(Date.now() - Math.random() * 3600000).toISOString()
        }));
        
      return Promise.resolve({ data: activeAlerts });
    },
    
    // èŽ·å–èµ„é‡‘å®‰å…¨çŠ¶æ€ (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    getFundSafety: () => {
      console.warn('âš ï¸  èŽ·å–èµ„é‡‘å®‰å…¨ - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”');
      return Promise.resolve({
        data: {
          totalFunds: 1250000 + Math.random() * 100000 - 50000,
          fundChange: Math.random() * 10000 - 5000,
          safetyRating: ['excellent', 'good', 'warning'][Math.floor(Math.random() * 3)],
          exchangeFunds: [
            {
              name: 'Binance',
              amount: 450000 + Math.random() * 50000,
              percentage: 36.0 + Math.random() * 5,
              status: Math.random() > 0.9 ? 'warning' : 'normal'
            },
            {
              name: 'OKX',
              amount: 380000 + Math.random() * 40000,
              percentage: 30.4 + Math.random() * 4,
              status: 'normal'
            },
            {
              name: 'Huobi',
              amount: 320000 + Math.random() * 30000,
              percentage: 25.6 + Math.random() * 3,
              status: Math.random() > 0.8 ? 'warning' : 'normal'
            },
            {
              name: 'Gate.io',
              amount: 100000 + Math.random() * 20000,
              percentage: 8.0 + Math.random() * 2,
              status: 'normal'
            }
          ],
          lastUpdated: new Date().toISOString()
        }
      });
    },
    
    // èŽ·å–é£Žé™©é…ç½® (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    getConfig: () => {
      console.warn('âš ï¸  èŽ·å–é£Žé™©é…ç½® - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”');
      return Promise.resolve({
        data: {
          settings: [
            {
              key: 'maxDrawdown',
              label: 'æœ€å¤§å›žæ’¤é™åˆ¶',
              description: 'å•æ—¥æœ€å¤§å›žæ’¤çŽ‡é™åˆ¶',
              value: 5.0,
              unit: '%'
            },
            {
              key: 'capitalLimit',
              label: 'èµ„é‡‘ä½¿ç”¨ä¸Šé™',
              description: 'æœ€å¤§èµ„é‡‘ä½¿ç”¨æ¯”ä¾‹',
              value: 80.0,
              unit: '%'
            },
            {
              key: 'positionLimit',
              label: 'å•ç¬”ä»“ä½é™åˆ¶',
              description: 'å•ç¬”äº¤æ˜“æœ€å¤§ä»“ä½æ¯”ä¾‹',
              value: 10.0,
              unit: '%'
            },
            {
              key: 'stopLoss',
              label: 'æ­¢æŸé˜ˆå€¼',
              description: 'è‡ªåŠ¨æ­¢æŸè§¦å‘é˜ˆå€¼',
              value: 2.0,
              unit: '%'
            }
          ]
        }
      });
    },
    
    // æ›´æ–°é£Žé™©é…ç½® (æ¨¡æ‹Ÿå®žçŽ° - åŽç«¯APIæœªå®žçŽ°)
    updateConfig: (config) => {
      console.warn('âš ï¸  æ›´æ–°é£Žé™©é…ç½® - åŽç«¯APIæœªå®žçŽ°ï¼Œè¿”å›žæ¨¡æ‹Ÿå“åº”');
      return Promise.resolve({
        data: { success: true, message: 'é£Žé™©é…ç½®æ›´æ–°æˆåŠŸ' }
      });
    },
  },

  // ===== æž¶æž„ç›‘æŽ§æ¨¡å— API =====
  architecture: {
    // èŽ·å–æœåŠ¡çŠ¶æ€åˆ—è¡¨
    getServices: async () => {
      console.warn('ðŸ”¶ [MOCK] æž¶æž„æœåŠ¡çŠ¶æ€API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 200));
      return {
        data: {
          services: [
            {
              name: 'APIç½‘å…³',
              type: 'web',
              description: 'ç»Ÿä¸€APIå…¥å£æœåŠ¡',
              status: 'healthy',
              response_time: 12,
              uptime: 86400 * 5 + 3600 * 2, // 5å¤©2å°æ—¶
              version: 'v3.2.0',
            },
            {
              name: 'å¥—åˆ©å¼•æ“Ž',
              type: 'api',
              description: 'æ ¸å¿ƒå¥—åˆ©ç®—æ³•æœåŠ¡',
              status: 'healthy',
              response_time: 8,
              uptime: 86400 * 3 + 3600 * 12, // 3å¤©12å°æ—¶
              version: 'v5.1.0',
            },
            {
              name: 'æ•°æ®æ”¶é›†å™¨',
              type: 'api',
              description: 'äº¤æ˜“æ‰€æ•°æ®æ”¶é›†æœåŠ¡',
              status: 'warning',
              response_time: 156,
              uptime: 86400 * 1 + 3600 * 6, // 1å¤©6å°æ—¶
              version: 'v2.3.1',
            },
            {
              name: 'PostgreSQL',
              type: 'database',
              description: 'ä¸»æ•°æ®åº“æœåŠ¡',
              status: 'healthy',
              response_time: 3,
              uptime: 86400 * 15 + 3600 * 8, // 15å¤©8å°æ—¶
              version: '14.2',
            },
            {
              name: 'Redis',
              type: 'redis',
              description: 'ç¼“å­˜æœåŠ¡',
              status: 'healthy',
              response_time: 1,
              uptime: 86400 * 12 + 3600 * 4, // 12å¤©4å°æ—¶
              version: '7.0',
            },
            {
              name: 'æ¶ˆæ¯é˜Ÿåˆ—',
              type: 'message-queue',
              description: 'RabbitMQæ¶ˆæ¯æœåŠ¡',
              status: 'healthy',
              response_time: 5,
              uptime: 86400 * 8 + 3600 * 15, // 8å¤©15å°æ—¶
              version: '3.9.0',
            }
          ]
        }
      };
    },
    
    // èŽ·å–å¥åº·æ£€æŸ¥ç»“æžœ
    getHealthCheck: async () => {
      console.warn('ðŸ”¶ [MOCK] å¥åº·æ£€æŸ¥API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 150));
      return {
        data: {
          status: 'warning',
          checks: [
            {
              name: 'æ•°æ®åº“è¿žæŽ¥',
              description: 'æ£€æŸ¥ä¸»æ•°æ®åº“è¿žæŽ¥çŠ¶æ€',
              status: 'pass',
              last_check: new Date(Date.now() - 30000).toISOString()
            },
            {
              name: 'ç¼“å­˜æœåŠ¡',
              description: 'æ£€æŸ¥Redisç¼“å­˜æœåŠ¡',
              status: 'pass',
              last_check: new Date(Date.now() - 45000).toISOString()
            },
            {
              name: 'æ¶ˆæ¯é˜Ÿåˆ—',
              description: 'æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—è¿žæŽ¥',
              status: 'pass',
              last_check: new Date(Date.now() - 60000).toISOString()
            },
            {
              name: 'å¤–éƒ¨API',
              description: 'æ£€æŸ¥äº¤æ˜“æ‰€APIè¿žæŽ¥',
              status: 'fail',
              last_check: new Date(Date.now() - 120000).toISOString()
            },
            {
              name: 'ç£ç›˜ç©ºé—´',
              description: 'æ£€æŸ¥ç³»ç»Ÿç£ç›˜ä½¿ç”¨çŽ‡',
              status: 'pass',
              last_check: new Date(Date.now() - 90000).toISOString()
            }
          ]
        }
      };
    },
    
    // èŽ·å–æ€§èƒ½æŒ‡æ ‡
    getMetrics: async () => {
      console.warn('ðŸ”¶ [MOCK] æ€§èƒ½æŒ‡æ ‡API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 100));
      return {
        data: {
          metrics: {
            cpu_usage: Math.floor(Math.random() * 40) + 20, // 20-60%
            memory_usage: Math.floor(Math.random() * 30) + 45, // 45-75%
            disk_usage: Math.floor(Math.random() * 20) + 30, // 30-50%
            network_throughput: Math.floor(Math.random() * 1024 * 1024 * 10), // 0-10MB/s
            active_connections: Math.floor(Math.random() * 200) + 50, // 50-250
            avg_response_time: Math.floor(Math.random() * 20) + 5, // 5-25ms
            requests_per_minute: Math.floor(Math.random() * 5000) + 1000, // 1000-6000
            success_rate: 95 + Math.random() * 4 // 95-99%
          }
        }
      };
    },
    
    // èŽ·å–ç³»ç»Ÿæ‹“æ‰‘å›¾
    getTopology: async () => {
      console.warn('ðŸ”¶ [MOCK] ç³»ç»Ÿæ‹“æ‰‘API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 300));
      return {
        data: {
          components: [
            { id: 1, name: 'Webå‰ç«¯', type: 'Frontend', x: 100, y: 100, status: 'healthy' },
            { id: 2, name: 'APIç½‘å…³', type: 'Gateway', x: 300, y: 100, status: 'healthy' },
            { id: 3, name: 'å¥—åˆ©å¼•æ“Ž', type: 'Service', x: 500, y: 50, status: 'healthy' },
            { id: 4, name: 'æ•°æ®æ”¶é›†å™¨', type: 'Service', x: 500, y: 150, status: 'warning' },
            { id: 5, name: 'PostgreSQL', type: 'Database', x: 700, y: 75, status: 'healthy' },
            { id: 6, name: 'Redis', type: 'Cache', x: 700, y: 125, status: 'healthy' }
          ],
          connections: [
            { from: { x: 160, y: 100 }, to: { x: 240, y: 100 }, type: 'sync' },
            { from: { x: 360, y: 100 }, to: { x: 440, y: 75 }, type: 'sync' },
            { from: { x: 360, y: 100 }, to: { x: 440, y: 125 }, type: 'sync' },
            { from: { x: 560, y: 75 }, to: { x: 640, y: 75 }, type: 'sync' },
            { from: { x: 560, y: 125 }, to: { x: 640, y: 125 }, type: 'async' }
          ]
        }
      };
    },
    
    // èŽ·å–ä¾èµ–å…³ç³»
    getDependencies: async () => {
      console.warn('ðŸ”¶ [MOCK] ä¾èµ–å…³ç³»API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 250));
      return {
        data: {
          dependencies: [
            {
              name: 'Binance API',
              type: 'å¤–éƒ¨æœåŠ¡',
              version: 'v3',
              status: 'available',
              latency: 45
            },
            {
              name: 'OKX API',
              type: 'å¤–éƒ¨æœåŠ¡',
              version: 'v5',
              status: 'available',
              latency: 62
            },
            {
              name: 'Huobi API',
              type: 'å¤–éƒ¨æœåŠ¡',
              version: 'v2',
              status: 'unavailable',
              latency: 999
            },
            {
              name: 'SMTPæœåŠ¡',
              type: 'é‚®ä»¶æœåŠ¡',
              version: 'v1',
              status: 'available',
              latency: 123
            },
            {
              name: 'Prometheus',
              type: 'ç›‘æŽ§æœåŠ¡',
              version: '2.40',
              status: 'available',
              latency: 8
            },
            {
              name: 'Grafana',
              type: 'å¯è§†åŒ–',
              version: '9.3',
              status: 'available',
              latency: 15
            }
          ]
        }
      };
    },
    
    // é‡å¯æœåŠ¡
    restartService: async (serviceName) => {
      console.warn('ðŸ”¶ [MOCK] é‡å¯æœåŠ¡API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 2000));
      return {
        data: {
          success: true,
          message: `æœåŠ¡ ${serviceName} é‡å¯æˆåŠŸ`
        }
      };
    },
  },

  // ===== å¯è§‚æµ‹æ€§æ¨¡å— API =====
  observability: {
    // èŽ·å–æ—¥å¿—èšåˆæ•°æ®
    getLogs: async (params = {}) => {
      console.warn('ðŸ”¶ [MOCK] æ—¥å¿—èšåˆAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      const { level, module, lines = 100 } = params;
      await new Promise(resolve => setTimeout(resolve, 200));
      
      const mockLogs = [
        {
          timestamp: new Date(Date.now() - 60000).toISOString(),
          level: 'INFO',
          module: 'arbitrage',
          message: 'å¥—åˆ©æœºä¼šæ£€æµ‹å®Œæˆï¼Œå‘çŽ°3ä¸ªæ½œåœ¨æœºä¼š'
        },
        {
          timestamp: new Date(Date.now() - 120000).toISOString(),
          level: 'WARN',
          module: 'collector',
          message: 'Binance APIå“åº”å»¶è¿Ÿè¾ƒé«˜: 850ms'
        },
        {
          timestamp: new Date(Date.now() - 180000).toISOString(),
          level: 'ERROR',
          module: 'risk',
          message: 'é£Žé™©é˜ˆå€¼è¶…é™ï¼šæŒä»“æ¯”ä¾‹è¾¾åˆ°85%'
        },
        {
          timestamp: new Date(Date.now() - 240000).toISOString(),
          level: 'DEBUG',
          module: 'gateway',
          message: 'å¤„ç†APIè¯·æ±‚: GET /api/system/status'
        },
        {
          timestamp: new Date(Date.now() - 300000).toISOString(),
          level: 'INFO',
          module: 'arbitrage',
          message: 'æˆåŠŸæ‰§è¡Œå¥—åˆ©äº¤æ˜“ï¼Œæ”¶ç›ŠçŽ‡2.3%'
        },
        {
          timestamp: new Date(Date.now() - 360000).toISOString(),
          level: 'WARN',
          module: 'collector',
          message: 'OKXè¿žæŽ¥é‡è¯•ä¸­ï¼Œå½“å‰é‡è¯•æ¬¡æ•°: 2/3'
        }
      ];
      
      return {
        data: {
          logs: level ? mockLogs.filter(log => log.level === level) : mockLogs
        }
      };
    },
    
    // èŽ·å–é“¾è·¯è¿½è¸ªæ•°æ®
    getTraces: async (params = {}) => {
      console.warn('ðŸ”¶ [MOCK] é“¾è·¯è¿½è¸ªAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 300));
      
      return {
        data: {
          traces: [
            {
              traceId: 'trace-001-abc123456789',
              operation: 'arbitrage-execute',
              duration: 245,
              status: 'success',
              timestamp: new Date(Date.now() - 300000).toISOString(),
              spans: [
                { serviceName: 'API Gateway', duration: 5 },
                { serviceName: 'Arbitrage Engine', duration: 120 },
                { serviceName: 'Risk Control', duration: 45 },
                { serviceName: 'Exchange API', duration: 75 }
              ]
            },
            {
              traceId: 'trace-002-def789012345',
              operation: 'data-collection',
              duration: 1250,
              status: 'success',
              timestamp: new Date(Date.now() - 600000).toISOString(),
              spans: [
                { serviceName: 'Data Collector', duration: 800 },
                { serviceName: 'Binance API', duration: 350 },
                { serviceName: 'Database', duration: 100 }
              ]
            },
            {
              traceId: 'trace-003-ghi345678901',
              operation: 'risk-assessment',
              duration: 89,
              status: 'error',
              timestamp: new Date(Date.now() - 900000).toISOString(),
              spans: [
                { serviceName: 'Risk Engine', duration: 65 },
                { serviceName: 'Database', duration: 24 }
              ]
            }
          ]
        }
      };
    },
    
    // èŽ·å–å‘Šè­¦åˆ—è¡¨
    getAlerts: async () => {
      console.warn('ðŸ”¶ [MOCK] å‘Šè­¦è§„åˆ™API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 150));
      
      return {
        data: {
          alerts: [
            {
              id: 1,
              name: 'CPUä½¿ç”¨çŽ‡è¿‡é«˜',
              condition: 'cpu_usage > 80%',
              severity: 'high',
              enabled: true
            },
            {
              id: 2,
              name: 'APIå“åº”æ—¶é—´å¼‚å¸¸',
              condition: 'response_time > 1000ms',
              severity: 'medium',
              enabled: true
            },
            {
              id: 3,
              name: 'é”™è¯¯çŽ‡è¶…è¿‡é˜ˆå€¼',
              condition: 'error_rate > 5%',
              severity: 'critical',
              enabled: true
            },
            {
              id: 4,
              name: 'äº¤æ˜“æ‰€è¿žæŽ¥å¤±è´¥',
              condition: 'exchange_connection == false',
              severity: 'critical',
              enabled: false
            },
            {
              id: 5,
              name: 'å†…å­˜ä½¿ç”¨çŽ‡è­¦å‘Š',
              condition: 'memory_usage > 70%',
              severity: 'low',
              enabled: true
            }
          ]
        }
      };
    },
    
    // èŽ·å–ç›‘æŽ§æŒ‡æ ‡
    getMetrics: async (metricName, timeRange = '1h') => {
      console.warn('ðŸ”¶ [MOCK] ç›‘æŽ§æŒ‡æ ‡API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 100));
      
      return {
        data: {
          metrics: {
            totalRequests: Math.floor(Math.random() * 50000) + 10000,
            errorRate: Math.random() * 5,
            avgResponseTime: Math.floor(Math.random() * 200) + 50,
            throughput: Math.floor(Math.random() * 1000) + 500
          }
        }
      };
    },
    
    // åˆ›å»ºè‡ªå®šä¹‰å‘Šè­¦è§„åˆ™
    createAlertRule: async (rule) => {
      console.warn('ðŸ”¶ [MOCK] åˆ›å»ºå‘Šè­¦è§„åˆ™API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
      
      await new Promise(resolve => setTimeout(resolve, 500));
      
      return {
        data: {
          success: true,
          message: 'å‘Šè­¦è§„åˆ™åˆ›å»ºæˆåŠŸ',
          ruleId: Date.now()
        }
      };
    },
  },

  // ===== é…ç½®ç®¡ç† API =====
  config: {
    // æ›´æ–°ç³»ç»Ÿé…ç½®
    update: (config) => apiClient.post('/api/config/update', config),
    
    // èŽ·å–ç³»ç»Ÿé…ç½®
    get: () => apiClient.get('/api/config'),
    
    // é‡è½½é…ç½®
    reload: () => apiClient.post('/api/config/reload'),
  },

  // ===== SystemdæŽ§åˆ¶ API =====
  systemd: {
    // å¯åŠ¨æœåŠ¡
    start: (service) => apiClient.post('/api/control/systemd/start', { service }),
    
    // åœæ­¢æœåŠ¡
    stop: (service) => apiClient.post('/api/control/systemd/stop', { service }),
    
    // é‡å¯æœåŠ¡
    restart: (service) => apiClient.post('/api/control/systemd/restart', { service }),
    
    // èŽ·å–æœåŠ¡çŠ¶æ€
    status: () => apiClient.get('/api/control/systemd/status'),
    
    // èŽ·å–æœåŠ¡æ—¥å¿—
    logs: (service, lines = 50) => 
      apiClient.get(`/api/control/systemd/logs?service=${service}&lines=${lines}`),
  },
};

// ===== æž¶æž„ç›‘æŽ§APIå‡½æ•° =====

// èŽ·å–æž¶æž„æ¦‚è§ˆ
export const getArchitectureOverview = async () => {
  console.warn('ðŸ”¶ [MOCK] æž¶æž„æ¦‚è§ˆAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  // Mock æ•°æ®
  return {
    data: {
      runningServices: 8,
      errorServices: 1,
      databaseConnections: 3,
      systemHealth: 92.5,
    }
  };
};

// èŽ·å–æœåŠ¡çŠ¶æ€
export const getServiceStatus = async () => {
  console.warn('ðŸ”¶ [MOCK] æœåŠ¡çŠ¶æ€API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        id: 1,
        name: 'å¥—åˆ©å¼•æ“Ž',
        description: 'æ ¸å¿ƒå¥—åˆ©ç®—æ³•æœåŠ¡',
        status: 'HEALTHY',
        port: 8080,
        version: 'v5.1.0',
        cpuUsage: 23.5,
        memoryUsage: 1024 * 1024 * 512, // 512MB
        lastCheck: new Date().toISOString(),
      },
      {
        id: 2,
        name: 'æ•°æ®æ”¶é›†å™¨',
        description: 'å¸‚åœºæ•°æ®æ”¶é›†æœåŠ¡',
        status: 'HEALTHY',
        port: 8081,
        version: 'v2.3.1',
        cpuUsage: 15.2,
        memoryUsage: 1024 * 1024 * 256, // 256MB
        lastCheck: new Date().toISOString(),
      },
      {
        id: 3,
        name: 'é£ŽæŽ§å¼•æ“Ž',
        description: 'å®žæ—¶é£Žé™©æŽ§åˆ¶æœåŠ¡',
        status: 'WARNING',
        port: 8082,
        version: 'v1.8.2',
        cpuUsage: 45.8,
        memoryUsage: 1024 * 1024 * 768, // 768MB
        lastCheck: new Date().toISOString(),
      },
      {
        id: 4,
        name: 'APIç½‘å…³',
        description: 'ç»Ÿä¸€APIå…¥å£æœåŠ¡',
        status: 'HEALTHY',
        port: 8083,
        version: 'v3.2.0',
        cpuUsage: 12.3,
        memoryUsage: 1024 * 1024 * 128, // 128MB
        lastCheck: new Date().toISOString(),
      }
    ]
  };
};

// èŽ·å–æ•°æ®åº“çŠ¶æ€
export const getDatabaseStatus = async () => {
  console.warn('ðŸ”¶ [MOCK] æ•°æ®åº“çŠ¶æ€API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        id: 1,
        name: 'PostgreSQL-ä¸»åº“',
        type: 'PostgreSQL 14.2',
        connected: true,
        connections: 45,
        latency: 2.3,
        size: 1024 * 1024 * 1024 * 2.5, // 2.5GB
        diskUsage: 68.5,
      },
      {
        id: 2,
        name: 'Redis-ç¼“å­˜',
        type: 'Redis 7.0',
        connected: true,
        connections: 12,
        latency: 0.8,
        size: 1024 * 1024 * 512, // 512MB
        diskUsage: 35.2,
      },
      {
        id: 3,
        name: 'InfluxDB-æ—¶åº',
        type: 'InfluxDB 2.6',
        connected: true,
        connections: 8,
        latency: 5.2,
        size: 1024 * 1024 * 1024 * 1.2, // 1.2GB
        diskUsage: 42.8,
      }
    ]
  };
};

// èŽ·å–ç½‘ç»œæ‹“æ‰‘
export const getNetworkTopology = async () => {
  console.warn('ðŸ”¶ [MOCK] ç½‘ç»œæ‹“æ‰‘API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: {
      nodes: [
        {
          name: 'APIç½‘å…³',
          ip: '10.0.1.100',
          status: 'active',
          connections: 156,
        },
        {
          name: 'å¥—åˆ©å¼•æ“Ž',
          ip: '10.0.1.101',
          status: 'active',
          connections: 23,
        },
        {
          name: 'æ•°æ®æ”¶é›†å™¨',
          ip: '10.0.1.102',
          status: 'active',
          connections: 45,
        },
        {
          name: 'é£ŽæŽ§å¼•æ“Ž',
          ip: '10.0.1.103',
          status: 'inactive',
          connections: 0,
        },
        {
          name: 'PostgreSQL',
          ip: '10.0.1.200',
          status: 'active',
          connections: 67,
        },
        {
          name: 'Redis',
          ip: '10.0.1.201',
          status: 'active',
          connections: 12,
        }
      ]
    }
  };
};

// èŽ·å–æ€§èƒ½æŒ‡æ ‡
export const getPerformanceMetrics = async () => {
  console.warn('ðŸ”¶ [MOCK] æ€§èƒ½æŒ‡æ ‡API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: {
      cpu: 34.2,
      memory: 67.8,
      networkIO: 1024 * 1024 * 12.5, // 12.5MB/s
      avgLatency: 23.4,
      systemLoad: 45.6,
      diskUsage: 58.3,
    }
  };
};

// ===== å¯è§‚æµ‹æ€§APIå‡½æ•° =====

// èŽ·å–æŒ‡æ ‡ä»ªè¡¨ç›˜æ•°æ®
export const getMetricsDashboard = async (timeRange = '1h') => {
  console.warn('ðŸ”¶ [MOCK] æŒ‡æ ‡ä»ªè¡¨ç›˜API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: {
      requestRate: 245.8,
      avgResponseTime: 23.4,
      errorRate: 0.12,
      activeConnections: 156,
    }
  };
};

// èŽ·å–æ—¥å¿—æµæ•°æ®
export const getLogStreams = async () => {
  console.warn('ðŸ”¶ [MOCK] æ—¥å¿—æµAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        id: 1,
        timestamp: new Date(),
        level: 'INFO',
        service: 'å¥—åˆ©å¼•æ“Ž',
        message: 'æˆåŠŸæ‰§è¡Œå¥—åˆ©ç­–ç•¥ BTC/USDTï¼Œåˆ©æ¶¦: 0.0023 BTC',
        metadata: {
          strategy: 'triangular_arbitrage',
          pair: 'BTC/USDT',
          profit: '0.0023'
        }
      },
      {
        id: 2,
        timestamp: new Date(Date.now() - 5000),
        level: 'WARN',
        service: 'æ•°æ®æ”¶é›†å™¨',
        message: 'å¸å®‰APIå“åº”å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼: 1200ms',
        metadata: {
          exchange: 'binance',
          latency: '1200ms',
          threshold: '800ms'
        }
      },
      {
        id: 3,
        timestamp: new Date(Date.now() - 10000),
        level: 'ERROR',
        service: 'é£ŽæŽ§å¼•æ“Ž',
        message: 'æ£€æµ‹åˆ°å¼‚å¸¸ä»·æ ¼æ³¢åŠ¨ï¼Œæš‚åœè‡ªåŠ¨äº¤æ˜“',
        metadata: {
          symbol: 'ETH/USDT',
          price_change: '-8.5%',
          action: 'pause_trading'
        }
      },
      {
        id: 4,
        timestamp: new Date(Date.now() - 15000),
        level: 'INFO',
        service: 'APIç½‘å…³',
        message: 'æ–°ç”¨æˆ·è¿žæŽ¥å»ºç«‹',
        metadata: {
          user_id: '12345',
          ip: '192.168.1.100',
          session: 'sess_abc123'
        }
      },
      {
        id: 5,
        timestamp: new Date(Date.now() - 20000),
        level: 'DEBUG',
        service: 'å¥—åˆ©å¼•æ“Ž',
        message: 'ä»·æ ¼å·®å¼‚è®¡ç®—: Binance vs OKX',
        metadata: {
          binance_price: '43250.50',
          okx_price: '43255.20',
          spread: '4.70'
        }
      }
    ]
  };
};

// èŽ·å–å‘Šè­¦è§„åˆ™æ•°æ®
export const getAlertRules = async () => {
  console.warn('ðŸ”¶ [MOCK] å‘Šè­¦è§„åˆ™API - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        id: 1,
        name: 'APIå“åº”æ—¶é—´è¿‡é«˜',
        description: 'å½“APIå¹³å‡å“åº”æ—¶é—´è¶…è¿‡500msæ—¶è§¦å‘å‘Šè­¦',
        status: 'FIRING',
        severity: 'HIGH',
        triggerCount: 3,
        lastTriggered: new Date(Date.now() - 300000),
        expression: 'avg(http_request_duration_seconds) > 0.5'
      },
      {
        id: 2,
        name: 'é”™è¯¯çŽ‡å¼‚å¸¸',
        description: 'å½“5åˆ†é’Ÿå†…é”™è¯¯çŽ‡è¶…è¿‡1%æ—¶è§¦å‘å‘Šè­¦',
        status: 'OK',
        severity: 'MEDIUM',
        triggerCount: 0,
        lastTriggered: new Date(Date.now() - 7200000),
        expression: 'rate(http_requests_errors[5m]) > 0.01'
      },
      {
        id: 3,
        name: 'å†…å­˜ä½¿ç”¨çŽ‡è¿‡é«˜',
        description: 'å½“ç³»ç»Ÿå†…å­˜ä½¿ç”¨çŽ‡è¶…è¿‡85%æ—¶è§¦å‘å‘Šè­¦',
        status: 'FIRING',
        severity: 'HIGH',
        triggerCount: 1,
        lastTriggered: new Date(Date.now() - 600000),
        expression: 'memory_usage_percent > 85'
      },
      {
        id: 4,
        name: 'æ•°æ®åº“è¿žæŽ¥æ•°å¼‚å¸¸',
        description: 'å½“æ•°æ®åº“è¿žæŽ¥æ•°è¶…è¿‡80æ—¶è§¦å‘å‘Šè­¦',
        status: 'OK',
        severity: 'LOW',
        triggerCount: 0,
        lastTriggered: new Date(Date.now() - 3600000),
        expression: 'db_connections_active > 80'
      }
    ]
  };
};

// èŽ·å–é“¾è·¯è¿½è¸ªæ•°æ®
export const getTraceData = async () => {
  console.warn('ðŸ”¶ [MOCK] é“¾è·¯è¿½è¸ªAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        traceId: '1a2b3c4d5e6f7g8h',
        operationName: '/api/arbitrage/execute',
        duration: 245.6,
        spans: [
          {
            serviceName: 'APIç½‘å…³',
            operationName: 'HTTP Request',
            duration: 12.3
          },
          {
            serviceName: 'å¥—åˆ©å¼•æ“Ž',
            operationName: 'calculate_arbitrage',
            duration: 156.8
          },
          {
            serviceName: 'äº¤æ˜“æ‰§è¡Œå™¨',
            operationName: 'execute_trades',
            duration: 76.5
          }
        ]
      },
      {
        traceId: '9i8h7g6f5e4d3c2b',
        operationName: '/api/data/collect',
        duration: 89.3,
        spans: [
          {
            serviceName: 'APIç½‘å…³',
            operationName: 'HTTP Request',
            duration: 5.2
          },
          {
            serviceName: 'æ•°æ®æ”¶é›†å™¨',
            operationName: 'fetch_market_data',
            duration: 67.4
          },
          {
            serviceName: 'æ•°æ®å¤„ç†å™¨',
            operationName: 'process_data',
            duration: 16.7
          }
        ]
      },
      {
        traceId: 'a1b2c3d4e5f6g7h8',
        operationName: '/api/risk/check',
        duration: 34.7,
        spans: [
          {
            serviceName: 'APIç½‘å…³',
            operationName: 'HTTP Request',
            duration: 3.1
          },
          {
            serviceName: 'é£ŽæŽ§å¼•æ“Ž',
            operationName: 'risk_assessment',
            duration: 28.9
          },
          {
            serviceName: 'æ•°æ®åº“',
            operationName: 'SELECT risk_rules',
            duration: 2.7
          }
        ]
      }
    ]
  };
};

// èŽ·å–æ€§èƒ½æ´žå¯Ÿæ•°æ®
export const getPerformanceInsights = async () => {
  console.warn('ðŸ”¶ [MOCK] æ€§èƒ½æ´žå¯ŸAPI - åŽç«¯æŽ¥å£æœªå®žçŽ°');
  
  return {
    data: [
      {
        id: 1,
        title: 'æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆ',
        category: 'æ•°æ®åº“ä¼˜åŒ–',
        severity: 'HIGH',
        description: 'æ£€æµ‹åˆ°äº¤æ˜“åŽ†å²æŸ¥è¯¢è¯­å¥æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¹³å‡å“åº”æ—¶é—´2.3ç§’',
        affectedService: 'å¥—åˆ©å¼•æ“Ž',
        performanceImpact: 'å“åº”æ—¶é—´å¢žåŠ 150%',
        recommendations: 'å»ºè®®æ·»åŠ å¤åˆç´¢å¼•: (symbol, timestamp) å¹¶è€ƒè™‘æ•°æ®åˆ†åŒº'
      },
      {
        id: 2,
        title: 'APIé™æµè§¦å‘é¢‘ç¹',
        category: 'å¤–éƒ¨ä¾èµ–',
        severity: 'MEDIUM',
        description: 'å¸å®‰APIè°ƒç”¨é¢‘çŽ‡æŽ¥è¿‘é™åˆ¶ï¼Œå¯èƒ½å½±å“æ•°æ®èŽ·å–å®žæ—¶æ€§',
        affectedService: 'æ•°æ®æ”¶é›†å™¨',
        performanceImpact: 'æ•°æ®å»¶è¿Ÿå¹³å‡350ms',
        recommendations: 'å®žçŽ°è¯·æ±‚ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤APIè°ƒç”¨ï¼Œè€ƒè™‘å‡çº§APIå¥—é¤'
      },
      {
        id: 3,
        title: 'å†…å­˜æ³„æ¼é£Žé™©',
        category: 'èµ„æºç®¡ç†',
        severity: 'HIGH',
        description: 'å¥—åˆ©å¼•æ“Žå†…å­˜ä½¿ç”¨é‡æŒç»­å¢žé•¿ï¼Œ24å°æ—¶å†…å¢žé•¿äº†40%',
        affectedService: 'å¥—åˆ©å¼•æ“Ž',
        performanceImpact: 'ç³»ç»Ÿç¨³å®šæ€§ä¸‹é™',
        recommendations: 'æ£€æŸ¥å¾ªçŽ¯å¼•ç”¨å’Œæœªé‡Šæ”¾çš„å¯¹è±¡ï¼Œè€ƒè™‘å®žçŽ°å®šæœŸåžƒåœ¾å›žæ”¶'
      },
      {
        id: 4,
        title: 'ç½‘ç»œå»¶è¿Ÿä¸ç¨³å®š',
        category: 'ç½‘ç»œä¼˜åŒ–',
        severity: 'MEDIUM',
        description: 'éƒ¨åˆ†äº¤æ˜“æ‰€è¿žæŽ¥å»¶è¿Ÿæ³¢åŠ¨è¾ƒå¤§ï¼Œå½±å“å¥—åˆ©æœºä¼šæ•èŽ·',
        affectedService: 'æ•°æ®æ”¶é›†å™¨',
        performanceImpact: 'å¥—åˆ©æœºä¼šè¯†åˆ«å»¶è¿Ÿ',
        recommendations: 'è€ƒè™‘ä½¿ç”¨å¤šä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œå®žçŽ°æ™ºèƒ½è·¯ç”±é€‰æ‹©'
      }
    ]
  };
};

// å¯¼å‡ºAPIå®¢æˆ·ç«¯å®žä¾‹ï¼ˆç”¨äºŽè‡ªå®šä¹‰è¯·æ±‚ï¼‰
export { apiClient };

// å¯¼å‡ºåŸºç¡€URL
export { API_BASE_URL };

// è¾…åŠ©å‡½æ•°ï¼šå¤„ç†APIé”™è¯¯
export const handleApiError = (error, defaultMessage = 'æ“ä½œå¤±è´¥') => {
  if (error.response) {
    return error.response.data?.message || defaultMessage;
  } else if (error.request) {
    return 'ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥';
  } else {
    return error.message || defaultMessage;
  }
};

// è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥APIå“åº”æ˜¯å¦æˆåŠŸ
export const isApiSuccess = (response) => {
  return response.data?.success === true || response.status === 200;
};

export default apiService;